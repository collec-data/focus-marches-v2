docker-image-api:
  extends: .build-docker
  variables:
    IMAGE: "${REGISTRY}focus-marches-v2/api"
    BUILD_CONTEXT: "api/."

api-quality:
  stage: üî® docker-build
  image: python:3.13@sha256:0c745292b7b34dcdd6050527907d78c39363dc45ad6afc6d107c454b93cebca1
  variables:
    FORCE_COLOR: true
  script:
    - python3 -m venv .venv
    - source .venv/bin/activate
    - cd api
    - pip install --upgrade pip
    - pip install -r dev-requirements.txt
    - unset DOCKER_AUTH_CONFIG # XXX: On ignore la configuration au sein des tests du √† une incompatibilit√© avec testcontainers
    - pytest
    - ruff format --check . || touch failed
    - ruff check . || touch failed
    - mypy . --strict || touch failed
    - '[ ! -e failed ] || ( echo "Ruff et/ou mypy ont remont√© des erreurs, voir les logs pr√©c√©dents"; exit 1 )'
