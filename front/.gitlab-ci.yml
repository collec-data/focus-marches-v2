build app:
  image: node:24@sha256:b52a8d1206132b36d60e51e413d9a81336e8a0206d3b648cabd6d5a49c4c0f54
  stage: ðŸ” build-quality
  script:
    - cd front
    - npm ci
    - npm run format-check
    - npm run lint-check
    - npm run test
    - npm run build
    - >
      if [[ "$CI_COMMIT_TAG" == "" ]]; then
        echo "TAG VIDE";
        VERSION=${CI_COMMIT_SHA:0:8};
      else
        echo "TAG PAS VIDE";
        VERSION=${CI_COMMIT_REF_NAME};
      fi
    - echo ${VERSION}
    # mise Ã  jour du fichier git-version.json avec la version du commit
    #- sed -i "s/dev/${VERSION}/g" public/git-version.json
    - npm run build
  coverage: '/All files[^|]*\|[^|]*\s+([\d\.]+)/'
  artifacts:
    expire_in: 15 mins
    paths:
      - front/dist/
    reports:
      coverage_report:
        coverage_format: cobertura
        path: front/coverage/cobertura-coverage.xml

docker-image-front:
  extends: .build-docker
  variables:
    IMAGE: "${REGISTRY}focus-marches-v2/front"
    BUILD_CONTEXT: "front/."
